电角度辨识 Edited
功能简介
电角度辨识仅针对永磁同步旋转电机、步进电机和永磁同步直线电机。
注：
1、空载下进行辨识
2、电机缺相时，辨识会失败。
3、编码器断开或者有干扰时，辨识会失败。
字典说明
电角度辨识模式相关参数
| 参数名称           | 字典名称                                                    | 主索引 | 子索引 | 数据类型  | 参数范围     | 读写权限 | 单位 | 字典指令值含义                                                                                                                                                                                                                                                                                                                                                               |
| ------------------ | ----------------------------------------------------------- | ------ | ------ | --------- | ------------ | -------- | ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 运行模式指令       | Operation Mode Command                                      | 0x6060 | 0x00   | INTEGER8  | -            | RW       | -    | 0x01：位置模式 0x03：速度模式 0x04：力矩模式 0x06：回零模式 0x0B：力控模式 0x3C：往复运动模式 0x16：模拟量控速度模式 0x17：模拟量控力矩模式 0x1F：脉冲控位置模式 0x3D：参考信号模式 0x2A：PWM 控速模式 0x3E：多段运行模式 0xFF：电气辨识 0xFE：方向辨识 0xFC：极对数辨识 0xFB：Z 相辨识 0xFD：霍尔辨识 0xFA：电角度辨识 0xF9：机械辨识 0xF7：机械特性辨识 0xF8：转矩脉动辨识 |
| 控制字             | DS402 Controlword                                           | 0x6040 | 0x00   | UNS16     | -            | RW       | -    |                                                                                                                                                                                                                                                                                                                                                                              |
| 电机额定电流       | Motor Continuous Current                                    | 0x6075 | 0x00   | INTEGER32 | 0~4294967295 | RW       | mA   |                                                                                                                                                                                                                                                                                                                                                                              |
| 辨识电流幅度相对值 | Identification Current Amplitude Relative                   | 0x3503 | 0x00   | UNS32     | 1~200        | RW       | %    |                                                                                                                                                                                                                                                                                                                                                                              |
| 电角度辨识模式     | Electrical Angle Identification Mode                        | 0x3638 | 0x00   | UNS8      | 0~4          | RW       | -    | 0：强拉寻相 3：短距离寻相 4：矢量寻相                                                                                                                                                                                                                                                                                                                                        |
| 电角度辨识超时时间 | Electrical Angle Identification Timeout Time                | 0x3639 | 0x00   | UNS32     | 0~100000     | RW       | ms   |                                                                                                                                                                                                                                                                                                                                                                              |
| 电角度辨识参数 1   | Electrical Angle Identification Parameter 1                 | 0x3654 | 0x00   | UNS32     | 1~1000       | RW       | uH   |                                                                                                                                                                                                                                                                                                                                                                              |
| 电角度辨识参数 2   | Motor ResistanceElectrical Angle Identification Parameter 2 | 0x3655 | 0x00   | UNS32     | 1~1000       | RW       | momh |                                                                                                                                                                                                                                                                                                                                                                              |
| 电角度辨识参数 3   | Electrical Angle Identification Parameter 3                 | 0x3656 | 0x00   | UNS32     | 1~2          | RW       |      |                                                                                                                                                                                                                                                                                                                                                                              |
| 状态字             | DS402 Statusword                                            | 0x6041 | 0x00   | UNS16     | -            | RW       | -    |                                                                                                                                                                                                                                                                                                                                                                              |
| 当前运行模式       | Operation Mode Actual                                       | 0x6061 | 0x00   | INTEGER8  | -            | RO       | -    | 0x01：位置模式 0x03：速度模式 0x04：力矩模式 0x06：回零模式 0x0B：力控模式 0x3C：往复运动模式 0x16：模拟量控速度模式 0x17：模拟量控力矩模式 0x1F：脉冲控位置模式 0x3D：参考信号模式 0x2A：PWM 控速模式 0x3E：多段运行模式 0xFF：电气辨识 0xFE：方向辨识 0xFC：极对数辨识 0xFB：Z 相辨识 0xFD：霍尔辨识 0xFA：电角度辨识 0xF9：机械辨识 0xF7：机械特性辨识 0xF8：转矩脉动辨识 |
| 辨识状态           | Identification State                                        | 0x3008 | 0x00   | UNS8      | 0~127        | RO       | -    | 0：启动开始空闲状态 1：辨识成功 2：电气辨识中 3：方向辨识中 4：机械辨识中 5：转矩脉动辨识中 255：错误状态                                                                                                                                                                                                                                                                    |
| 电机运行状态       | Motor Operation Status                                      | 0x3005 | 0x00   | UNS8      | 0~255        | RO       | -    | 0：电机失能 1：电机使能                                                                                                                                                                                                                                                                                                                                                      |
| 电角度偏移值       | Electrical Angle Offset                                     | 0x35A4 | 0x00   | UNS32     | 0~4294967295 | RO       | -    |                                                                                                                                                                                                                                                                                                                                                                              |
电角度辨识模式指令参数
| 参数名称           | 字典名称                                                    | 主索引 | 子索引 | 数据类型  | 参数范围     | 读写权限 | 单位 | 字典指令值含义                                                                                                                                                                                                                                                                                                                                                               |
| ------------------ | ----------------------------------------------------------- | ------ | ------ | --------- | ------------ | -------- | ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 运行模式指令       | Operation Mode Command                                      | 0x6060 | 0x00   | INTEGER8  | -128~127     | RW       | -    | 0x01：位置模式 0x03：速度模式 0x04：力矩模式 0x06：回零模式 0x0B：力控模式 0x3C：往复运动模式 0x16：模拟量控速度模式 0x17：模拟量控力矩模式 0x1F：脉冲控位置模式 0x3D：参考信号模式 0x2A：PWM 控速模式 0x3E：多段运行模式 0xFF：电气辨识 0xFE：方向辨识 0xFC：极对数辨识 0xFB：Z 相辨识 0xFD：霍尔辨识 0xFA：电角度辨识 0xF9：机械辨识 0xF7：机械特性辨识 0xF8：转矩脉动辨识 |
| 控制字             | DS402 Controlword                                           | 0x6040 | 0x00   | UNS16     | 0~65535      | RW       | -    |                                                                                                                                                                                                                                                                                                                                                                              |
| 电机额定电流       | Motor Continuous Current                                    | 0x6075 | 0x00   | INTEGER32 | 0~4294967295 | RW       | mA   |                                                                                                                                                                                                                                                                                                                                                                              |
| 辨识电流幅度相对值 | Identification Current Amplitude Relative                   | 0x3503 | 0x00   | UNS32     | 1~200        | RW       | %    |                                                                                                                                                                                                                                                                                                                                                                              |
| 电角度辨识模式     | Electrical Angle Identification Mode                        | 0x3638 | 0x00   | UNS8      | 0~4          | RW       | -    | 0：强拉寻相 3：短距离寻相 4：矢量寻相                                                                                                                                                                                                                                                                                                                                        |
| 电角度辨识超时时间 | Electrical Angle Identification Timeout Time                | 0x3639 | 0x00   | UNS32     | 0~100000     | RW       | ms   |                                                                                                                                                                                                                                                                                                                                                                              |
| 电角度辨识参数 1   | Electrical Angle Identification Parameter 1                 | 0x3654 | 0x00   | UNS32     | 1~1000       | RW       | uH   |                                                                                                                                                                                                                                                                                                                                                                              |
| 电角度辨识参数 2   | Motor ResistanceElectrical Angle Identification Parameter 2 | 0x3655 | 0x00   | UNS32     | 1~1000       | RW       | momh |                                                                                                                                                                                                                                                                                                                                                                              |
| 电角度辨识参数 3   | Electrical Angle Identification Parameter 3                 | 0x3656 | 0x00   | UNS32     | 1~2          | RW       |      |                                                                                                                                                                                                                                                                                                                                                                              |
运行模式指令 6060h-00h
运动模式（0x6060-0x00）设置为 0xFA 时，表示电角度辨识模式，此时当前运行模式（0x6061-0x00）为 0xFA。任意运行模式在使能或者失能的状态下都可以切换到电角度辨识模式。
注：任何辨识模式都不响应暂停指令。
控制字 6040h-00h
控制字释义表
| bit   | 名称                    | 含义（中文）         | 描述                              |
| ----- | ----------------------- | -------------------- | --------------------------------- |
| 0     | switch on               | 伺服准备好           | 0：无效 1：有效                   |
| 1     | enable voltage          | 伺服已接通电源       | 0：无效 1：有效                   |
| 2     | quick  stop             | 快速停机             | 1：无效 0：有效                   |
| 3     | enable operation        | 伺服运行             | 0：无效 1：有效                   |
| 4~6   | operation mode specific | 不同运行模式含义不同 |                                   |
| 7     | fault                   | 故障                 | 0->1：有效 0->0、1->1、1->0：无效 |
| 8     | halt                    | 暂停                 | 0：无效 1：有效                   |
| 9~10  | reserved                | 预留                 |                                   |
| 11~15 | manufacturer specific   | 厂家自定义           |                                   |
电角度辨识模式下 bit4~bit6
| bit | 含义     | 描述   |
| --- | -------- | ------ |
| 4   | reserved | 未定义 |
| 5   | reserved | 未定义 |
| 6   | reserved | 未定义 |
电角度辨识模式下的控制命令和状态切换
| 操作         | 控制字 6040h | 驱动器状态         | 状态字 6041h |
| ------------ | ------------ | ------------------ | ------------ |
| 伺服失能     | 0x05         | switch on disabled | 0x250        |
| 伺服未准备好 | 0x06         | ready to switch on | 0x231        |
| 伺服使能     | 0x0F         | operation enable   | 0x237        |
电机额定电流 6075h-00h
用户可根据电机参数设置电机额定电流。
辨识电流幅度相对值 3503h-00h
辨识电流占电机额定电流的百分比。
应用于电气辨识、方向辨识、极对数辨识、霍尔辨识、Z 相辨识、电角度辨识、转矩脉动辨识。
注：在一般情况下不需要设置这个参数，在电机电感较小（小于 100uH），可以适当提高辨识电流幅值以获得更加准确得电机电感参数。
电角度辨识模式 3638h-00h
| 值 | 含义       | 描述                                      |
| -- | ---------- | ----------------------------------------- |
| 0  | 强拉寻相   | 适用于大部分旋转电机、直线电机。          |
| 3  | 短距离寻相 | 适用于行程较短的直线电机或音圈电机。      |
| 4  | 矢量寻相   | 适用于大惯量、直线电机 + 弹簧等特殊场景。 |
电角度辨识超时时间 3639h-00h
默认 40s，电角辨识时间超过 40s 后报电角度辨识错误。
电角度辨识参数 1 3654h-00h
寻相距离。仅适用于短距离寻相电角度辨识模式。一般使用默认值即可。
电角度辨识参数 2 3655h-00h
置信区间。仅适用于短距离寻相电角度辨识模式。一般使用默认值即可。
电角度参数 3 3656h-00h
电流上升时间。仅适用于短距离寻相电角度辨识模式。一般使用默认值即可。
电角度辨识模式监测参数
| 参数名称     | 字典名称                | 主索引 | 子索引 | 数据类型 | 参数范围     | 读写权限 | 单位 | 字典指令值含义                                                                                                                                                                                                                                                                                                                                                               |
| ------------ | ----------------------- | ------ | ------ | -------- | ------------ | -------- | ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 状态字       | DS402 Statusword        | 0x6041 | 0x00   | UNS16    | -            | RW       | -    |                                                                                                                                                                                                                                                                                                                                                                              |
| 电机运行状态 | Motor Operation Status  | 0x3005 | 0x00   | UNS8     | 0~255        | RO       | -    |                                                                                                                                                                                                                                                                                                                                                                              |
| 当前运行模式 | Operation Mode Actual   | 0x6061 | 0x00   | INTEGER8 | -            | RO       | -    | 0x01：位置模式 0x03：速度模式 0x04：力矩模式 0x06：回零模式 0x0B：力控模式 0x3C：往复运动模式 0x16：模拟量控速度模式 0x17：模拟量控力矩模式 0x1F：脉冲控位置模式 0x3D：参考信号模式 0x2A：PWM 控速模式 0x3E：多段运行模式 0xFF：电气辨识 0xFE：方向辨识 0xFC：极对数辨识 0xFB：Z 相辨识 0xFD：霍尔辨识 0xFA：电角度辨识 0xF9：机械辨识 0xF7：机械特性辨识 0xF8：转矩脉动辨识 |
| 辨识状态     | Identification State    | 0x3008 | 0x00   | UNS8     | 0~127        | RO       | -    | 0：启动开始空闲状态 1：辨识成功 2：电气辨识中 3：方向辨识中 4：机械辨识中 5：转矩脉动辨识中 255：错误状态                                                                                                                                                                                                                                                                    |
| 电角度偏移值 | Electrical Angle Offset | 0x35A4 | 0x00   | UNS32    | 0~4294967295 | RO       | -    |                                                                                                                                                                                                                                                                                                                                                                              |
状态字 6041h-00h
状态字释义表
| bit   | 名称                    | 含义             | 描述                                                                          |
| ----- | ----------------------- | ---------------- | ----------------------------------------------------------------------------- |
| 0     | ready to switch on      | 伺服未准备好     | 0：无效 1：有效                                                               |
| 1     | switched on             | 伺服已接通 PWM   | 0：无效 1：有效                                                               |
| 2     | operation enabled       | 伺服使能         | 0：无效 1：有效                                                               |
| 3     | fault                   | 故障             | 0：无效 1：有效                                                               |
| 4     | voltage enabled         | 驱动器已接通电源 | 0：无效 1：有效                                                               |
| 5     | quick stop              | 急停             | 0：无效 1：有效                                                               |
| 6     | switch on disabled      | 伺服未接通 PWM   | 0：无效 1：有效                                                               |
| 7     | warning                 | 警告             | 0：无效 1：有效                                                               |
| 8     | manufacture specific    | 厂家自定义       | 预留，未定义                                                                  |
| 9     | remote                  | 远程控制         | 0：非 CANopen 模式 1：CANopen 远程控制模式                                    |
| 10    | target reached          | 目标已到达       | 0：无效 1：有效                                                               |
| 11    | internal limit active   | 软件内部位置超限 | 0：位置指令或反馈未到达软件内部位置限制 1：位置指令或反馈达到软件内部位置限制 |
| 12~13 | operation mode specific | 运行模式定义状态 | 与运行模式有关                                                                |
| 14~15 | manufacture specific    | 厂家自定义       | 预留，未定义                                                                  |
状态字bit0-bit3，bit5，bit6 定义
| Value(binary)指令值 | State状态      |
| --------------------------- | ---------------------- |
| xxxx xxxx x0xx 0000         | Not ready to switch on |
| xxxx xxxx x1xx 0000         | Switch on disabled     |
| xxxx xxxx x01x 0001         | Ready to switch on     |
| xxxx xxxx x01x 0011         | Switched on            |
| xxxx xxxx x01x 0111         | Operation enabled      |
| xxxx xxxx x00x 0111         | Quick stop active      |
| xxxx xxxx x0xx 1111         | Fault reaction active  |
| xxxx xxxx x0xx 1000         | Fault                  |
状态字Bit10、Bit12、Bit13 定义
| Bit | Value | Definition含义 |
| ------- | --------- | ---------------------- |
| 10      | -         | 未定义                 |
| 11      | -         | 未定义                 |
| 12      | -         | 未定义                 |
| 13      | -         | 未定义                 |
电机运行状态 3005h-00h
电机状态与伺服状态关系
| 402 状态               | 电机状态 |
| ---------------------- | -------- |
| Not ready to switch on | 电机失能 |
| Switch on disabled     | 电机失能 |
| Ready to switch on     | 电机失能 |
| Switched on            | 电机失能 |
| Operation enabled      | 电机使能 |
| Quick stop active      | 电机使能 |
| Fault                  | 电机失能 |
当前运行模式 6061h-00h
反馈当前运行模式，出厂设置为 0，表示空模式，空模式可以切换到任意模式。
当运行模式指令 = 0xFA(-6)时，当前运行模式 = 0xFA(-6)。
辨识状态 3005h-00h
| 值  | 含义             |
| --- | ---------------- |
| 0   | 启动开启空闲状态 |
| 1   | 辨识成功         |
| 2   | 电气辨识中       |
| 3   | 方向辨识中       |
| 4   | 机械辨识中       |
| 5   | 转矩脉动辨识中   |
| 255 | 辨识错误         |
电角度偏移值 35A4h-00h
电角度辨识成功后输出此值。
模式下控制字使用
模式动作对应的控制字：
| 动作            | 驱动器状态                         | 对应控制字 |
| ------------------- | -------------------------------------- | -------------- |
| 失能                | Switch on disabled->Ready to switch on | 0x06           |
| 失能-> 使能（启动） | Switch on disabled->Operation  enabled | 0x0F           |
|                     | Ready to switch on->Operation  enabled |                |
| 使能-> 失能         | Operation enabled->Ready to switch on  | 0x06           |
|                     | Operation enabled->Switch on disabled  | 0x05           |
| 故障-> 失能         | Fault->Switch on diabled               | 0x86           |
模式设置流程

以上媒体的描述: 这是一张流程图，描述了一个系统或设备的操作流程。流程图中包含多个步骤和决策点，使用箭头连接各个步骤，表示流程的顺序。具体内容如下：

检查驱动器当前状态
查询状态字（0x6041-0x00）
状态字是否为Ready to switch on?
否：发送控制字0x06（0x6040-0x00 = 0x06）
是：设置电角度辨识模式（0x6060-0x00 = 0xFA）
设置电角度辨识参数
0x3654-0x00，0x3655-0x00，0x3656-0x00
使能电机
查询电机状态（0x3005-0x00）
电机是否已经使能
否：发送控制字使能（0x6040-0x00 = 0x0F）
是：查询辨识状态（0x3008-0x00）
检查辨识是否完成
否：检查辨识是否失败
是：发送控制字清除错误（0x6040-0x00 = 0x86）


是：流程结束

这个流程图可能用于控制系统或设备的初始化和状态检查过程。