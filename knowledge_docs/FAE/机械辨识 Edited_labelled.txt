机械辨识 Edited
功能简介
用户需要设置电机额定参数，整定机械速度将被自动设置为电机额定转速的 10%，整定机械电流被自动设置为电机额定电流，开始辨识后电机将高频振动直到检测电机转速达到整定机械速度后停止。辨识完成后将刷新电机转子惯量，需要用户正确设置转矩常数，辨识出来的转子惯量才会与实际量纲一致。
注：1、电机缺相时，辨识会失败。
字典说明
机械辨识模式相关字典
| 参数名称                 | 字典名称                                           | 主索引 | 子索引 | 数据类型  | 参数范围               | 读写权限 | 单位                            | 字典指令值含义                                                                                                                                                                                                                                                                                                                                                               |
| ------------------------ | -------------------------------------------------- | ------ | ------ | --------- | ---------------------- | -------- | ------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 运行模式指令             | Operation Mode Command                             | 0x6060 | 0x00   | INTEGER8  | -                      | RW       | -                               | 0x01：位置模式 0x03：速度模式 0x04：力矩模式 0x06：回零模式 0x0B：力控模式 0x3C：往复运动模式 0x16：模拟量控速度模式 0x17：模拟量控力矩模式 0x1F：脉冲控位置模式 0x3D：参考信号模式 0x2A：PWM 控速模式 0x3E：多段运行模式 0xFF：电气辨识 0xFE：方向辨识 0xFC：极对数辨识 0xFB：Z 相辨识 0xFD：霍尔辨识 0xFA：电角度辨识 0xF9：机械辨识 0xF7：机械特性辨识 0xF8：转矩脉动辨识 |
| 控制字                   | DS402 Controlword                                  | 0x6040 | 0x00   | UNS16     | -                      | RW       | -                               |                                                                                                                                                                                                                                                                                                                                                                              |
| 电机额定电流             | Motor Continuous Current                           | 0x6075 | 0x00   | INTEGER32 | 0~4294967295           | RW       | mA                              |                                                                                                                                                                                                                                                                                                                                                                              |
| 机械辨识电机频率         | Mechanical Identification Motor Frequency          | 0x3504 | 0x00   | UNS32     | 0~4294967295           | RW       | Hz                              |                                                                                                                                                                                                                                                                                                                                                                              |
| 机械辨识电机速度相对值   | Mechanical Identification Motor Speed Relative     | 0x3505 | 0x00   | UNS32     | 1~100                  | RW       | %                               |                                                                                                                                                                                                                                                                                                                                                                              |
| 机械辨识电机电流相对值   | Mechanical Identification Current Current Relative | 0x3506 | 0x00   | UNS32     | 1~200                  | RW       | %                               |                                                                                                                                                                                                                                                                                                                                                                              |
| 机械辨识位置限制最小值   | Mechanical Identification Position Lower Limit     | 0x3508 | 0x00   | INTEGER32 | -2147483648~2124283647 | RW       | PosCU（位置坐标转换，用户单位） |                                                                                                                                                                                                                                                                                                                                                                              |
| 机械辨识位置限制最大值   | Mechanical Identification Position Upper Limit     | 0x3507 | 0x00   | INTEGER32 | -2147483648~2124283647 | RW       | PosCU（位置坐标转换，用户单位） |                                                                                                                                                                                                                                                                                                                                                                              |
| 状态字                   | DS402 Statusword                                   | 0x6041 | 0x00   | UNS16     | -                      | RW       | -                               |                                                                                                                                                                                                                                                                                                                                                                              |
| 当前运行模式             | Operation Mode Actual                              | 0x6061 | 0x00   | INTEGER8  | -                      | RO       | -                               | 0x01：位置模式 0x03：速度模式 0x04：力矩模式 0x06：回零模式 0x0B：力控模式 0x3C：往复运动模式 0x16：模拟量控速度模式 0x17：模拟量控力矩模式 0x1F：脉冲控位置模式 0x3D：参考信号模式 0x2A：PWM 控速模式 0x3E：多段运行模式 0xFF：电气辨识 0xFE：方向辨识 0xFC：极对数辨识 0xFB：Z 相辨识 0xFD：霍尔辨识 0xFA：电角度辨识 0xF9：机械辨识 0xF7：机械特性辨识 0xF8：转矩脉动辨识 |
| 辨识状态                 | Identification State                               | 0x3008 | 0x00   | UNS8      | 0~127                  | RO       | -                               | 0：启动开始空闲状态 1：辨识成功 2：电气辨识中 3：方向辨识中 4：机械辨识中 5：转矩脉动辨识中 255：错误状态                                                                                                                                                                                                                                                                    |
| 电机运行状态             | Motor Operation Status                             | 0x3005 | 0x00   | UNS8      | 0·255                 | RO       | -                               | 0：电机失能 1：电机使能                                                                                                                                                                                                                                                                                                                                                      |
| 电机转子惯量（旋转电机） | Motor Rotor Inertia                                | 0x3516 | 0x00   | UNS32     | 0~4294967295           | RW       | g*cm2                           |                                                                                                                                                                                                                                                                                                                                                                              |
| 电机动子质量（直线电机） | Motor Mover Mass                                   | 0x35C4 | 0x00   | UNS32     | 0~4294967295           | RW       | g                               |                                                                                                                                                                                                                                                                                                                                                                              |
机械辨识模式指令参数
| 参数名称               | 字典名称                                           | 主索引 | 子索引 | 数据类型  | 参数范围               | 读写权限 | 单位                            | 字典指令值含义                                                                                                                                                                                                                                                                                                                                                               |
| ---------------------- | -------------------------------------------------- | ------ | ------ | --------- | ---------------------- | -------- | ------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 运行模式指令           | Operation Mode Command                             | 0x6060 | 0x00   | INTEGER8  | -128~127               | RW       | -                               | 0x01：位置模式 0x03：速度模式 0x04：力矩模式 0x06：回零模式 0x0B：力控模式 0x3C：往复运动模式 0x16：模拟量控速度模式 0x17：模拟量控力矩模式 0x1F：脉冲控位置模式 0x3D：参考信号模式 0x2A：PWM 控速模式 0x3E：多段运行模式 0xFF：电气辨识 0xFE：方向辨识 0xFC：极对数辨识 0xFB：Z 相辨识 0xFD：霍尔辨识 0xFA：电角度辨识 0xF9：机械辨识 0xF7：机械特性辨识 0xF8：转矩脉动辨识 |
| 控制字                 | DS402 Controlword                                  | 0x6040 | 0x00   | UNS16     | 0~65535                | RW       | -                               |                                                                                                                                                                                                                                                                                                                                                                              |
| 电机额定电流           | Motor Continuous Current                           | 0x6075 | 0x00   | INTEGER32 | 0~4294967295           | RW       | mA                              |                                                                                                                                                                                                                                                                                                                                                                              |
| 机械辨识电机频率       | Mechanical Identification Motor Frequency          | 0x3504 | 0x00   | UNS32     | 0~4294967295           | RW       | Hz                              |                                                                                                                                                                                                                                                                                                                                                                              |
| 机械辨识电机速度相对值 | Mechanical Identification Motor Speed Relative     | 0x3505 | 0x00   | UNS32     | 1~100                  | RW       | %                               |                                                                                                                                                                                                                                                                                                                                                                              |
| 机械辨识电流相对值     | Mechanical Identification Current Current Relative | 0x3506 | 0x00   | UNS32     | 1~200                  | RW       | %                               |                                                                                                                                                                                                                                                                                                                                                                              |
| 机械辨识位置限制最大值 | Mechanical Identification Position Upper Limit     | 0x3507 | 0x00   | INTEGER32 | -2147483648~2124283647 | RW       | PosCU（位置坐标转换，用户单位） |                                                                                                                                                                                                                                                                                                                                                                              |
| 机械辨识位置限制最小值 | Mechanical Identification Position Lower Limit     | 0x3508 | 0x00   | INTEGER32 | -2147483648~2124283647 | RW       | PosCU（位置坐标转换，用户单位） |                                                                                                                                                                                                                                                                                                                                                                              |
运行模式指令 6060h-00h
运动模式（0x6060-0x00）设置为 0xFF 时，表示电气辨识模式，此时当前运行模式（0x6061-0x00）为 0xFF。任意运行模式在使能或者失能的状态下都可以切换到电气辨识模式。
注：任何辨识模式都不响应暂停指令。
控制字 6040h-00h
控制字释义表
| bit   | 名称                    | 含义（中文）         | 描述                              |
| ----- | ----------------------- | -------------------- | --------------------------------- |
| 0     | switch on               | 伺服准备好           | 0：无效 1：有效                   |
| 1     | enable voltage          | 伺服已接通电源       | 0：无效 1：有效                   |
| 2     | quick  stop             | 快速停机             | 1：无效 0：有效                   |
| 3     | enable operation        | 伺服运行             | 0：无效 1：有效                   |
| 4~6   | operation mode specific | 不同运行模式含义不同 |                                   |
| 7     | fault                   | 故障                 | 0->1：有效 0->0、1->1、1->0：无效 |
| 8     | halt                    | 暂停                 | 0：无效 1：有效                   |
| 9~10  | reserved                | 预留                 |                                   |
| 11~15 | manufacturer specific   | 厂家自定义           |                                   |
机械辨识模式下 bit4~bit6
| bit | 含义     | 描述   |
| --- | -------- | ------ |
| 4   | reserved | 未定义 |
| 5   | reserved | 未定义 |
| 6   | reserved | 未定义 |
机械辨识模式下的控制命令和状态切换
| 操作         | 控制字 6040h | 驱动器状态         | 状态字 6041h |
| ------------ | ------------ | ------------------ | ------------ |
| 伺服失能     | 0x05         | switch on disabled | 0x250        |
| 伺服未准备好 | 0x06         | ready to switch on | 0x231        |
| 伺服使能     | 0x0F         | operation enable   | 0x237        |
电机额定电流 6075h-00h
用户可根据电机参数设定电机额定电流。
机械辨识电机频率 3504h-00h
开始机械辨识后电机将以机械辨识电机频率做高频振动直到检测电机转速达到整定机械速度后停止。一般使用默认值即可，不用修改。
机械辨识电机速度相对值 3505h-00h
机械辨识速度相对值为机械辨识速度占应用速度限制值的百分比。
开始机械辨识后电机将以机械辨识电机频率做高频振动直到检测电机转速达到整定机械速度后停止。一般使用默认值即可，可根据实际情况进行微调。
机械辨识电流相对值 3506h-00h
机械辨识电流幅度相对值机械辨识电流占电机额定电流的百分比。一般使用默认值即可，可根据实际情况进行微调。
机械辨识位置限制最大值 3507h-00h
用来约束机械辨识过程中电机运动的软件位置范围。一般使用默认值即可，不用修改
机械辨识位置限制最大值 ≤ 软件位置限制最大值。
机械辨识位置限制最小值 3508h-00h
用来约束机械辨识过程中电机运动的软件位置范围。一般使用默认值即可，不用修改。
机械辨识位置限制最小值 ≥ 软件位置限制最小值。
机械辨识模式监测参数
| 参数名称                 | 字典名称               | 主索引 | 子索引 | 数据类型 | 参数范围     | 读写权限 | 单位  | 字典指令值含义                                                                                                                                                                                                                                                                                                                                                               |
| ------------------------ | ---------------------- | ------ | ------ | -------- | ------------ | -------- | ----- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 状态字                   | DS402 Statusword       | 0x6041 | 0x00   | UNS16    | -            | RW       | -     |                                                                                                                                                                                                                                                                                                                                                                              |
| 电机运行状态             | Motor Operation Status | 0x3005 | 0x00   | UNS8     | 0~255        | RO       | -     |                                                                                                                                                                                                                                                                                                                                                                              |
| 当前运行模式             | Operation Mode Actual  | 0x6061 | 0x00   | INTEGER8 | -            | RO       | -     | 0x01：位置模式 0x03：速度模式 0x04：力矩模式 0x06：回零模式 0x0B：力控模式 0x3C：往复运动模式 0x16：模拟量控速度模式 0x17：模拟量控力矩模式 0x1F：脉冲控位置模式 0x3D：参考信号模式 0x2A：PWM 控速模式 0x3E：多段运行模式 0xFF：电气辨识 0xFE：方向辨识 0xFC：极对数辨识 0xFB：Z 相辨识 0xFD：霍尔辨识 0xFA：电角度辨识 0xF9：机械辨识 0xF7：机械特性辨识 0xF8：转矩脉动辨识 |
| 辨识状态                 | Identification State   | 0x3008 | 0x00   | UNS8     | 0~127        | RO       | -     | 0：启动开始空闲状态 1：辨识成功 2：电气辨识中 3：方向辨识中 4：机械辨识中 5：转矩脉动辨识中 255：错误状态                                                                                                                                                                                                                                                                    |
| 电机转子惯量（旋转电机） | Motor Rotor Inertia    | 0x3516 | 0x00   | UNS32    | 0~4294967295 | RW       | g*cm2 |                                                                                                                                                                                                                                                                                                                                                                              |
| 电机动子质量（直线电机） | Motor Mover Mass       | 0x35C4 | 0x00   | UNS32    | 0~4294967295 | RW       | g     |                                                                                                                                                                                                                                                                                                                                                                              |
状态字 6041h-00h
状态字释义表
| bit   | 名称                    | 含义             | 描述                                                                          |
| ----- | ----------------------- | ---------------- | ----------------------------------------------------------------------------- |
| 0     | ready to switch on      | 伺服未准备好     | 0：无效 1：有效                                                               |
| 1     | switched on             | 伺服已接通 PWM   | 0：无效 1：有效                                                               |
| 2     | operation enabled       | 伺服使能         | 0：无效 1：有效                                                               |
| 3     | fault                   | 故障             | 0：无效 1：有效                                                               |
| 4     | voltage enabled         | 驱动器已接通电源 | 0：无效 1：有效                                                               |
| 5     | quick stop              | 急停             | 0：无效 1：有效                                                               |
| 6     | switch on disabled      | 伺服未接通 PWM   | 0：无效 1：有效                                                               |
| 7     | warning                 | 警告             | 0：无效 1：有效                                                               |
| 8     | manufacture specific    | 厂家自定义       | 预留，未定义                                                                  |
| 9     | remote                  | 远程控制         | 0：非 CANopen 模式 1：CANopen 远程控制模式                                    |
| 10    | target reached          | 目标已到达       | 0：无效 1：有效                                                               |
| 11    | internal limit active   | 软件内部位置超限 | 0：位置指令或反馈未到达软件内部位置限制 1：位置指令或反馈达到软件内部位置限制 |
| 12~13 | operation mode specific | 运行模式定义状态 | 与运行模式有关                                                                |
| 14~15 | manufacture specific    | 厂家自定义       | 预留，未定义                                                                  |
状态字bit0-bit3，bit5，bit6 定义
| Value(binary)指令值 | State状态      |
| --------------------------- | ---------------------- |
| xxxx xxxx x0xx 0000         | Not ready to switch on |
| xxxx xxxx x1xx 0000         | Switch on disabled     |
| xxxx xxxx x01x 0001         | Ready to switch on     |
| xxxx xxxx x01x 0011         | Switched on            |
| xxxx xxxx x01x 0111         | Operation enabled      |
| xxxx xxxx x00x 0111         | Quick stop active      |
| xxxx xxxx x0xx 1111         | Fault reaction active  |
| xxxx xxxx x0xx 1000         | Fault                  |
状态字Bit10、Bit12、Bit13 定义
| Bit | Value | Definition含义 |
| ------- | --------- | ---------------------- |
| 10      | -         | 未定义                 |
| 11      | -         | 未定义                 |
| 12      | -         | 未定义                 |
| 13      | -         | 未定义                 |
电机运行状态 3005h-00h
电机状态与伺服状态关系
| 402 状态               | 电机状态 |
| ---------------------- | -------- |
| Not ready to switch on | 电机失能 |
| Switch on disabled     | 电机失能 |
| Ready to switch on     | 电机失能 |
| Switched on            | 电机失能 |
| Operation enabled      | 电机使能 |
| Quick stop active      | 电机使能 |
| Fault                  | 电机失能 |
当前运行模式 6061h-00h
反馈当前运行模式，出厂设置为 0，表示空模式，空模式可以切换到任意模式。
当运行模式指令 = 0xFF(-1)时，当前运行模式 = 0xFF(-1)。
辨识状态 3005h-00h
| 值  | 含义             |
| --- | ---------------- |
| 0   | 启动开启空闲状态 |
| 1   | 辨识成功         |
| 2   | 电气辨识中       |
| 3   | 方向辨识中       |
| 4   | 机械辨识中       |
| 5   | 转矩脉动辨识中   |
| 255 | 辨识错误         |
电机转子惯量（旋转电机）3516h-00h
对于旋转电机，机械辨识成功会输出电机转子惯量。
电机动子质量（直线电机）35C4h-00h
对于直线电机，机械辨识成功会输出电机动子质量。
模式下控制字使用
模式动作对应的控制字：
| 动作            | 驱动器状态                         | 对应控制字 |
| ------------------- | -------------------------------------- | -------------- |
| 失能                | Switch on disabled->Ready to switch on | 0x06           |
| 失能-> 使能（启动） | Switch on disabled->Operation  enabled | 0x0F           |
|                     | Ready to switch on->Operation  enabled |                |
| 使能-> 失能         | Operation enabled->Ready to switch on  | 0x06           |
|                     | Operation enabled->Switch on disabled  | 0x05           |
| 故障-> 失能         | Fault->Switch on diabled               | 0x86           |
模式设置流程

以上媒体的描述: 这是一张流程图，描述了一个电机控制系统的状态转换过程。流程图中的步骤和决策点如下：

检测驱动器当前状态。
查询状态字（0x6041-0x00）。
判断“准备好开启”状态。
如果否，发送控制字0x06（0x6040-0x00 = 0x06），返回步骤1。
如果是，设置机械制动模式（0x6060-0x00 = 0xF9）。
使能电机。
发送控制字使能（0x6040-0x00 = 0x0F）。
查询电机状态（0x3005-0x00）。
判断电机是否已经使能。
如果否，返回步骤4。
如果是，检查辨识是否完成。
判断辨识是否完成。
如果否，检查辨识是否失败。
如果是，发送控制字清除错误（0x6040-0x00 = 0x86），返回步骤1。


如果是，发送控制字手失能（0x6040-0x00 = 0x06）。
查询辨识状态（0x3008-0x00）。

这个流程图详细描述了电机控制系统在不同状态下的操作步骤和决策点。